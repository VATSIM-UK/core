#!/usr/bin/env bash

# pre-commit hook for Laravel Pint
# Auto-fix staged files, but fail commit if anything was fixed.

if [ -f "$HOME/.bashrc" ]; then
    . "$HOME/.bashrc"
fi

set -euo pipefail

# Get staged PHP files
staged_files=$(git diff --cached --name-only --diff-filter=ACM | grep '\.php$' || true)
[ -z "$staged_files" ] && exit 0

echo "Running Pint..."
composer lint -- --quiet $staged_files || true

# Check if Pint changed any of the staged files
fixed_files=$(git diff --name-only -- $staged_files)

if [ -n "$fixed_files" ]; then
    echo
    echo "⚠️  Pint fixed some files. Please re-add them and commit again:"
    echo "$fixed_files"
    exit 1
fi

echo "✅ Pint made no changes."
exit 0
